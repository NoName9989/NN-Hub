-- BY HENGI --
--// Script Loader GUI v4
-- C√≥ Save/Load nhi·ªÅu script + ƒë·∫∑t t√™n + xo√°
-- L∆∞u v√†o file, tho√°t game v·∫´n c√≤n
-- D√πng cho Delta X (executor h·ªó tr·ª£ writefile/readfile)

local player = game.Players.LocalPlayer
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "ScriptLoader"

local HttpService = game:GetService("HttpService")
local saveFile = "saved_scripts.json"

-- Khung ch√≠nh
local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 400, 0, 280)
main.Position = UDim2.new(0.3, 0, 0.3, 0)
main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
main.Active = true
main.Draggable = true

-- TextBox nh·∫≠p script
local scriptBox = Instance.new("TextBox", main)
scriptBox.Size = UDim2.new(0.55, -20, 0, 100)
scriptBox.Position = UDim2.new(0, 10, 0, 10)
scriptBox.Text = "-- D√°n script v√†o ƒë√¢y --"
scriptBox.TextWrapped = true
scriptBox.ClearTextOnFocus = false
scriptBox.MultiLine = true
scriptBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
scriptBox.TextColor3 = Color3.fromRGB(255,255,255)

scriptBox.Focused:Connect(function()
    scriptBox.Text = ""
end)

-- Delay Box
local delayBox = Instance.new("TextBox", main)
delayBox.Size = UDim2.new(0, 60, 0, 30)
delayBox.Position = UDim2.new(0, 10, 0, 120)
delayBox.Text = "1"
delayBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
delayBox.TextColor3 = Color3.fromRGB(255,255,255)

local delayLabel = Instance.new("TextLabel", main)
delayLabel.Size = UDim2.new(0, 100, 0, 30)
delayLabel.Position = UDim2.new(0, 80, 0, 120)
delayLabel.Text = "Delay (s)"
delayLabel.BackgroundTransparency = 1
delayLabel.TextColor3 = Color3.fromRGB(255,255,255)

-- N√∫t b·∫≠t/t·∫Øt
local toggleBtn = Instance.new("TextButton", main)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0, 160)
toggleBtn.Text = "‚ñ∂ B·∫≠t"
toggleBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 70)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- N√∫t ƒë√≥ng
local closeBtn = Instance.new("TextButton", main)
closeBtn.Size = UDim2.new(0, 100, 0, 30)
closeBtn.Position = UDim2.new(0, 120, 0, 160)
closeBtn.Text = "‚úñ ƒê√≥ng"
closeBtn.BackgroundColor3 = Color3.fromRGB(130, 70, 70)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- N√∫t Save script
local saveBtn = Instance.new("TextButton", main)
saveBtn.Size = UDim2.new(0, 100, 0, 30)
saveBtn.Position = UDim2.new(0, 230, 0, 10)
saveBtn.Text = "üíæ Save"
saveBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 130)
saveBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- N√∫t Load script
local loadBtn = Instance.new("TextButton", main)
loadBtn.Size = UDim2.new(0, 100, 0, 30)
loadBtn.Position = UDim2.new(0, 230, 0, 50)
loadBtn.Text = "üìÇ Load"
loadBtn.BackgroundColor3 = Color3.fromRGB(130, 70, 130)
loadBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- N√∫t Delete script
local deleteBtn = Instance.new("TextButton", main)
deleteBtn.Size = UDim2.new(0, 100, 0, 30)
deleteBtn.Position = UDim2.new(0, 230, 0, 90)
deleteBtn.Text = "üóë Delete"
deleteBtn.BackgroundColor3 = Color3.fromRGB(180, 70, 70)
deleteBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- ListBox hi·ªÉn th·ªã scripts ƒë√£ l∆∞u
local listBox = Instance.new("ScrollingFrame", main)
listBox.Size = UDim2.new(0, 150, 0, 160)
listBox.Position = UDim2.new(0, 230, 0, 130)
listBox.CanvasSize = UDim2.new(0,0,0,0)
listBox.BackgroundColor3 = Color3.fromRGB(40,40,40)

-- Bi·∫øn l∆∞u scripts
local savedScripts = {}
local selectedScript

-- Load scripts t·ª´ file
pcall(function()
    if isfile(saveFile) then
        local data = readfile(saveFile)
        savedScripts = HttpService:JSONDecode(data)
    end
end)

-- H√†m update list
local function updateList()
    listBox:ClearAllChildren()
    local y = 0
    for i, sc in ipairs(savedScripts) do
        local btn = Instance.new("TextButton", listBox)
        btn.Size = UDim2.new(1, -5, 0, 25)
        btn.Position = UDim2.new(0, 0, 0, y)
        btn.Text = sc.Name
        btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
        btn.TextColor3 = Color3.fromRGB(255,255,255)
        btn.MouseButton1Click:Connect(function()
            selectedScript = i
            for _,b in ipairs(listBox:GetChildren()) do
                if b:IsA("TextButton") then
                    b.BackgroundColor3 = Color3.fromRGB(60,60,60)
                end
            end
            btn.BackgroundColor3 = Color3.fromRGB(100,100,200)
        end)
        y = y + 30
    end
    listBox.CanvasSize = UDim2.new(0,0,0,y)
end
updateList()

-- N√∫t Save
saveBtn.MouseButton1Click:Connect(function()
    -- t·∫°o khung nh·∫≠p t√™n
    local nameBox = Instance.new("TextBox", main)
    nameBox.Size = UDim2.new(0, 150, 0, 30)
    nameBox.Position = UDim2.new(0, 10, 0, 200)
    nameBox.PlaceholderText = "Nh·∫≠p t√™n script..."
    nameBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    nameBox.TextColor3 = Color3.fromRGB(255,255,255)

    nameBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and nameBox.Text ~= "" then
            table.insert(savedScripts, {Name = nameBox.Text, Code = scriptBox.Text})
            writefile(saveFile, HttpService:JSONEncode(savedScripts))
            updateList()
            nameBox:Destroy()
        else
            nameBox:Destroy()
        end
    end)
end)

-- N√∫t Load
loadBtn.MouseButton1Click:Connect(function()
    if selectedScript and savedScripts[selectedScript] then
        scriptBox.Text = savedScripts[selectedScript].Code
    end
end)

-- N√∫t Delete
deleteBtn.MouseButton1Click:Connect(function()
    if selectedScript and savedScripts[selectedScript] then
        table.remove(savedScripts, selectedScript)
        writefile(saveFile, HttpService:JSONEncode(savedScripts))
        selectedScript = nil
        updateList()
    end
end)

-- Logic ch·∫°y loop
local running = false
local loopThread

local function runLoop()
    if loopThread then
        task.cancel(loopThread)
        loopThread = nil
    end
    loopThread = task.spawn(function()
        while running do
            local code = scriptBox.Text
            local delayTime = tonumber(delayBox.Text) or 1
            local func, err = loadstring(code)
            if func then
                task.spawn(func)
            else
                warn("L·ªói code: "..err)
            end
            task.wait(delayTime)
        end
    end)
end

toggleBtn.MouseButton1Click:Connect(function()
    running = not running
    if running then
        toggleBtn.Text = "‚è∏ T·∫Øt"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 180, 70)
        runLoop()
    else
        toggleBtn.Text = "‚ñ∂ B·∫≠t"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 70)
        if loopThread then
            task.cancel(loopThread)
            loopThread = nil
        end
    end
end)

closeBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)
-- N√∫t thu nh·ªè
local minimizeBtn = Instance.new("TextButton", main)
minimizeBtn.Size = UDim2.new(0, 100, 0, 30)
minimizeBtn.Position = UDim2.new(0, 10, 0, 240)
minimizeBtn.Text = "‚ûñ Thu nh·ªè"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- √î vu√¥ng nh·ªè khi thu g·ªçn
local miniFrame = Instance.new("ImageButton", gui)
miniFrame.Size = UDim2.new(0, 50, 0, 50)
miniFrame.Position = UDim2.new(0, 20, 0, 200) -- v·ªã tr√≠ ban ƒë·∫ßu
miniFrame.Image = "rbxassetid://6421296794"
miniFrame.Visible = false
miniFrame.BackgroundTransparency = 1
miniFrame.Active = true
miniFrame.Draggable = true

-- S·ª± ki·ªán thu nh·ªè
minimizeBtn.MouseButton1Click:Connect(function()
    main.Visible = false
    miniFrame.Visible = true
end)

-- Click v√†o √¥ vu√¥ng ƒë·ªÉ m·ªü l·∫°i GUI
miniFrame.MouseButton1Click:Connect(function()
    main.Visible = true
    miniFrame.Visible = false

-- N√∫t ƒë·ªïi Theme
local themeBtn = Instance.new("TextButton", main)
themeBtn.Size = UDim2.new(0, 100, 0, 30)
themeBtn.Position = UDim2.new(0, 120, 0, 240)
themeBtn.Text = "üé® Theme"
themeBtn.BackgroundColor3 = Color3.fromRGB(100,100,150)
themeBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- Theme settings
local currentTheme = "Dark"

local themes = {
    Dark = {
        main = Color3.fromRGB(30, 30, 30),
        textbox = Color3.fromRGB(50, 50, 50),
        text = Color3.fromRGB(255, 255, 255),
        button = Color3.fromRGB(70, 70, 130)
    },
    Light = {
        main = Color3.fromRGB(230, 230, 230),
        textbox = Color3.fromRGB(250, 250, 250),
        text = Color3.fromRGB(0, 0, 0),
        button = Color3.fromRGB(200, 200, 250)
    }
}

-- H√†m ƒë·ªïi theme
local function applyTheme(name)
    local t = themes[name]
    if not t then return end
    
    main.BackgroundColor3 = t.main
    scriptBox.BackgroundColor3 = t.textbox
    scriptBox.TextColor3 = t.text
    delayBox.BackgroundColor3 = t.textbox
    delayBox.TextColor3 = t.text
    delayLabel.TextColor3 = t.text

    for _,btn in ipairs(main:GetChildren()) do
        if btn:IsA("TextButton") then
            btn.BackgroundColor3 = t.button
            btn.TextColor3 = t.text
        end
    end
end

-- N√∫t ƒë·ªïi Theme b·∫•m ƒë·ªÉ chuy·ªÉn Dark <-> Light
themeBtn.MouseButton1Click:Connect(function()
    if currentTheme == "Dark" then
        currentTheme = "Light"
    else
        currentTheme = "Dark"
    end
    applyTheme(currentTheme)
end)

-- Kh·ªüi t·∫°o theme m·∫∑c ƒë·ªãnh
applyTheme(currentTheme)
end)
